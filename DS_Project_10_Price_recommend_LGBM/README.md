# Проект 10. Определение стоимости автомобилей

### Вводная: 
Платформа по продаже автомобилей "AB-и-ТО" хочет дать возможность своим клиентам быстро узнать рыночную стоимость своего автомобиля. Для построения модели вам предоставили датасет объявлений, который содержит информацию о технических характеристиках, датах активности пользователя и ценах на автомобили.  

При выборе модели необходимо рассмотреть:

- качество предсказания;
- скорость предсказания;
- время обучения.

### Цель проекта 
​	Построить модель для определения рыночной стоимости автомобиля по его признакам.

### Что было сделано:
**1.** На первом этапе мы подготовили данные к дальнейшему анализу.

В изначальных данных мы получили информацию о 354369 объявлениях. В 5и строках наблюдались пропуски. 

1.2 Была проведена предобработка данных:  

1.2.1. Мы нашли и удалили дубликаты

1.2.2. Был выбран метод кодировки признаков  
Было решено использовать Ordinal encoding.  
Также на данном этапе были обнаружены проблемы в признаках `RegistrationMonth`, `Kilometer`, `FuelType`, `NumberOfPictures`. 

1.2.3. Далее мы проанализировали значения "проблемных" признаков

    RegistrationMonth: Появляется нулевой месяц. В целом, 0 появляются примерно также как и остальные месяца. 
    Есть два возможных объяснения: 
    1. Этот признак сформирован автоматически, при его формировании случайно добавили "нулевой месяц"; 
    2. Так записывали пропущенные значения. Поскольку признаки категориальные, можем оставить все как есть, работу моделей это не изменит, информацию можно будет получить.
    FuelType: Был проверен и одобрен список уникальных значений.
    NumberOfPictures: Этот признак состоял только из нулей. Скорее всего эти данные были потеряны при формировании датасета. Поскольку эти данные мы восстановить никак не можем, признак был удален.

1.2.4. Ordinal encoding  
После создания списка категориальных переменных мы их закодировали.

1.2.5.  Обработка пропусков  
Заполнение пропусков было проведено с помощью KNNImputer, который заполняет значения по n ближайшим соседям. Алгоритм реализовывался batch-ами, которые разделяли выборку на несколько подвыборок. Заполнение мы оценивали по признаку `NotRepaired`, где самое большое количество пропусков и признаку `FuelType`. После оценки мы пришли к выводу, что заполнение было проведено успешно.

**2.** На данном этапе мы проводили исследовательский анализ данных.  
2.1 В начале были рассмотрены распределения признаков и проведена оценка аномальных значений.

- `Kilometer`: Обнаруживаем ещё одну проблему: очень много максимальных значений 150 тыс. км. Среднестатистический автомобиль проезжает около 15 тыс. км в год. Получается у нас большинство автомобилей возрастом около 10 лет.
Скорее всего возникла ошибка при создании датасета, это потенциально проблемное место.

- `Price`: Распределение похоже на распределения Пуассона – наблюдался пик значений около 1500 евро и длинный хвост справа.

- `Power`: Было обнаружено большое количество нулевых значений (40225). Почему могут возникать нулевые значения?  
    Первый вариант: люди таким образом указывают то что автомобиль не на ходу.  
    Второй вариант: пропущенные значения в датасете были заполнены нулями.  
    Могут быть и другие варианты, однако неоднозначность в объяснении склоняет нас к тому, что эти значения не могут быть восстановлены или заменены на другие и их придется удалить. Также были удалены слишком большие значения. 

2.2 Была проведена оценка корреляции признаков.  
Для категориальных признаков мы использовали коэффициент корреляции V Крамера. 

Самая большая корреляция наблюдалась у `Brand` и `Model` (0.79), а также, как мы и ожидали, обнаруживается корреляция между `VehicleType` и `Model` (0.57). На данном этапе мы решили удалить признак `Model`.

**3.** Третий этап был посвящен обучению моделей.  

3.1. Мы выбрали метрики для оценки качества моделей.  
Для оценки моделей на этапе обучений мы решили использовать метрику RMSE, поскольку она легко считается, а также придаёт больший вес большим ошибкам. Также, для лучшей интерпретируемости оценки, мы решили добавить MAE на этап анализа моделей.

3.2. Обучали модели и оценивали их качество кросс-валидацией.
Случайным образом, в соотношении 4:1, создали тестовую выборку. 

3.3. Рассмотрели работу модели Light GBM

    Wall time поиска лучшей модели: 9min 53s  
    Лучшие параметры: {'num_leaves': 70, 'min_child_samples': 30, 'max_depth': 10, 'learning_rate': 0.01}  
    Лучший RMSE: 2579.22  

3.4. Модель RandomForestRegressor

    Wall time поиска лучшей модели: 2min 12s  
    Лучшие параметры: {'max_depth': 11, 'n_estimators': 30}  
    Лучший RMSE: 1947.94

Модель случайного леса показывала лучшие результаты чем LGBM, однако для дальнейшего анализа мы взяли обе модели. 

**4.** На последнем этапе мы провели анализ построенных моделей.

4.1. Модели были проверены на тестовой выборке, для каждой были оценены время работы и точность их предсказаний.

4.2. Все модели были проверены на адекватность  

Итоговая RMSE dummy модели, не использующей машинное обучение, составила 4881.56. Как оказалось, наши модели были построены не зря – они имеют большую точность (около 1959 у модели случайного леса).

4.3.  Сравнение характеристик моделей: скорость работы и качество предсказаний
Результаты работы наших моделей:

| Модель            | Время обучения | Время предсказания | **RMSE** | **MAE** |
| :---------------- | -------------- | ------------------ | -------- | ------- |
| **Light GBM**     | 21.5 c         | 1.8 с              | 2584.71  | 1886.49 |
| **Случайный лес** | 12.8 c         | 0.28 с             | 1959.02  | 1237.97 |

Как видим, по всем параметрам модель случайного леса работает лучше Light GBM. Её средняя абсолютная ошибка равняется 1237.97. Случайный лес сделал предсказания для ≈ 60 тысяч объявлений за 300 милисекунд.

Самая главная проблема – ошибка примерно в 1200 евро у лучшей модели. Это довольно плохой результат с точки зрения бизнеса, ведь клиенты хотят узнать максимально точную оценку для своего автомобиля. Для того, чтобы улучшить предсказания необходимо разобраться с первоначальными данными. В первую очередь, для этого нужно получить реальные значения километража, а также понять, откуда появляются нулевые значения в столбце с мощностью.