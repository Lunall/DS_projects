# Проект 14. Распознавание возраста покупателей

### Вводная 
Сеть торговых центров «Ultra Mall» хочет дополнить свою систему видеонаблюдения технологией компьютерного зрения. Обработка фотографий покупателей в торговых залах поможет определять возраст клиентов и решать следующие задачи:

• Классификация и составление портрета клиента для персонализации предложений;  
• Контроль продаж алкоголя и табачных изделий несовершеннолетним. 

### Цель

    Построить модель, которая по фотографии определит приблизительный возраст человека. MAE модели должно быть меньше 8.

### Описание данных

В данном проекте используется датасет APPA-REAL (real and apparent age).  
https://chalearnlap.cvc.uab.cat/dataset/26/description/
    
Датасет содержит 7 591 изображение с соответствующими метками реального возраста и его оценок (стандартная ошибка 0,3). 

Изображения разделены на 4113 изображений для обучающей, 1500 валидационной и 1978 тестовой выборки, они представлены в папках `train/`, `valid/` и `test/`. Реальный возраст и предполагаемый находятся в файлах `gt_train.csv, gt_test.csv и gt_valid.csv` с отдельной строкой для каждого возраста.

### Что было сделано:

**1.** На первом этапе мы провели исследовательский анализ датасета.

Каждое изображение мы нормализовали, применив рескейлинг 1/255.

На графике распределения возраста было два пика значений – медианное значение около 28 лет, и пик возле минимального значения в 1 год. График имеет сдвиг влево. Среднее значение целевого признака 31.2 лет.

Всего в датасете 7591 цветных изображений с размеченным возрастом. Размерность изображений (224, 224, 3). Некоторые изображения имеют черные поля.

**2.** Далее мы обучили модель на сервере и сохранили результат её работы.

Опишем основные характеристики нашей модели:

В основе сети лежала остаточная CNN **ResNet50** с весами, полученными на датасете `imagenet`.
Модель решала задачу регрессии, поэтому в верхнем слое сети находился только 1 нейрон с активацией ReLU (для того, чтобы не было отрицательных значений возраста).

Для градиентной оптимизации использовался алгоритм Adam. Функция потерь MSE.

После обучения и валидации модели на сервере мы получили **тестовое MAE = 6.1192**. Наша модель ошибается в среднем на 6 лет на тестовой выборке. 

Скорость работы модели: 1920 тестовых изображений было обработано за 9 секунд.

**3.** Анализ обученной модели.

В итоге у нас имеется 23,5 млн параметров, которые учит модель. В первом слое лежит модель ResNet, далее идет глобальный двумерный пулинг усреднением — пулинг с окном во весь тензор, который усредняет информацию по всему изображению. В конце находится 1 полносвязный нейрон с 2049 параметрами.

3.1.  Для оценки модели мы сравнили её результат с MAE dummy-модели. Dummy-модель предсказывала средний возраст выборки для каждого изображения.

MAE dummy-модели составило 13.3, что значительно менее точно чем предсказания нашей модели с MAE 6.1.

В целом ошибка в 6 лет позволяет с хорошей точностью отнести человека к определенной возрастной категории. Для задачи анализа покупок и предложения товаров, которые могут заинтересовать покупателей нужной возрастной группы, модель подходит и рекомендована к использованию.

Если перед нами стоит задача контроля добросовестности кассиров при продаже алкоголя, то полученной точности может не хватить.
