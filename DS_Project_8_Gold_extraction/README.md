# Проект 8. Сколько золота будет восстановлено?

### Вводная: 
  После того как всю нефть мы успешно выкачали из земли, компания "Vankor" решила перепрофилироваться и начать обрабатывать  золотосодержащую руду для получения золота. Перед тем как запускать предприятие нам необходимо предсказать коэффициент восстановления золота в одной из золотоперерабатывающих систем – компания не хочет начинать убыточный проект.
    
  Для анализа и построения предсказаний вам предоставлены данные с параметрами добычи и очистки золота с очистительной системы которую хочет купить себе компания.

### Цель проекта 
Построить модель, которая будет предсказывать коэффициент восстановления золота из золотосодержащей руды.

### Что было сделано:
**1.** На первом этапе мы подготовили данные к дальнейшему анализу.

1.1. Загрузили файлы и получили информацию о них.  

1.2. Далее на обучающей выборке проверили, что эффективность обогащения рассчитана правильно. MAE между расчётами и значением признака составляло 1.09e-14, расчеты проведены верно.  

1.3. Провели анализ признаков, недоступных в тестовой выборке.  

1.4. Провели предобработку данных    

- Сформировали обучающая и тестовая выборки.  

- Обработали пропуски (16208 пропущенных значений). 

- Восстановление данных  
Были восстановлены новые train и test из полных данных.  

<ins> Возможная причина появления пропусков:</ins>  
Поскольку один замер (наша дата) это состояние всей очистительной системы, пропущенные значения могут появляться на старте производства, когда сырьё поступило на обработку; в конце дня, когда сырьё уже не поступает, но некоторые из установок работают, и в схожих ситуациях.
Оставшиеся пропуски мы заменили с помощью KNNImputer, который заполняет значения по n ближайшим соседям.

- Проверка дубликатов показала что полных дубликатов нет.

**2.** На втором этапе мы проводили исследовательский анализ данных.  

2.1. В начале были рассмотрены процессы изменения концентрации металлов (Au, Ag, Pb) на различных этапах очистки.

`Au Золото` Судя по графикам, концентрация золота в сырье увеличивается с каждой очисткой. 

`Ag Серебро` Серебро начинает вести себя совсем по-другому: после флотации (первой очистки) его концентрация повышается, но после 2 этапа очистки она падает ниже начального уровня. 

`Pb Свинец` Концентрация свинца последовательно уменьшается на всех этапах обработки. Опять наблюдаем нулевые значения.

2.2. Далее было проведено сравнение распределения размеров гранул сырья на обучающей и тестовой выборках.  
Распределение размеров гранул в выборках было одинаковым. 

2.3. Мы исследовали суммарную концентрацию всех веществ на разных стадиях. 

1) Сырьё. Распределение близко к нормальному, со смещением вправо. Пик значений около 57. Аномальных значений не было. 

2) Черновой и финальный концентрат. На этих этапах обработки мы наблюдали большое количество нулевых значений, остальное распределение было близко к нормальному, со смещением вправо и длинным хвостом слева.

2.4. В конце была оценена корреляция признаков.
После построения матрицы корреляции мы нашли что между некоторыми признаками есть сильная корреляция (больше 0.8). 
Была создана функция, позволяющая задать трешхолд и получить список из коррелирующих признаков для удаления.

**3.** На последнем этапе мы обучали и выбирали наилучшую модель. 

3.1. Сначала мы создали функцию для вычисления итоговой метрики `sMAPE`.  
3.2. После мы перешли к обучению моделей и оценке их качества кросс-валидацией.

Поскольку у нас 2 целевых признака, для каждого мы обучали и искали наилучшую модель отдельно.
Модели мы запускали с перебором трешхолда корреляции и удалением коллинеарных признаков.

Результаты обучения моделей:

| Название модели        | Граница корр. | Кол-во признаков | Лучшая итоговая **sMAPE** |
| :--------------------- | ------------- | ---------------- | ------------------------- |
| **Линейная регрессия** | 1             | 52               | 12.0833                   |
| **Дерево решений**     | 0.3           | 2                | 13.9228                   |
| **Случайный лес**      | 0.8           | 29               | 12.7015                   |
| **Lasso регрессия**    | 0.8           | 29               | 12.1209                   |

3.2.5. Таким образом, мы пришли к выводу что **лучшая модель для предсказания: Линейная регрессия**.

    Гиперпараметры:  
    Граница корреляции: 1.0 
    Размерность признаков для предсказания: (15585, 52)   
    Лучшие параметры для rougher.output.recovery: {'fit_intercept': False, 'normalize': True}    
    Лучшие параметры для final.output.recovery: {'fit_intercept': True, 'normalize': False}  
    Лучшая итоговая sMAPE: 12.0833

3.3. Далее мы выполнили проверку лучшей модели на тестовой выборке.

Получили что итоговая sMAPE для тестовой выборки: 8.6203.

3.4. В конце была проведена проверка лучшей модели на адекватность.

Итоговая sMAPE dummy модели, не использующей машинное обучение, составила 11.0404. Наши построенные модели машинного обучения имеют большую точность (около 8.93).